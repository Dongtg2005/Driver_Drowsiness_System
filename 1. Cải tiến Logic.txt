1. C·∫£i ti·∫øn Logic t·ª´ng ph·∫ßn (Tr√°nh b√°o ·∫£o)
üëÅÔ∏è Ph·∫ßn M·∫Øt (EAR - Eye Aspect Ratio)
V·∫•n ƒë·ªÅ hi·ªán t·∫°i: ƒê√¥i khi b·∫°n ch·ªõp m·∫Øt b√¨nh th∆∞·ªùng (Blinking) h·ªá th·ªëng c≈©ng ƒë·∫øm l√† 1 frame nh·∫Øm. Ho·∫∑c khi c∆∞·ªùi, m·∫Øt h√≠p l·∫°i, EAR gi·∫£m -> B√°o sai.

C·∫£i ti·∫øn c·∫ßn thi·∫øt:

Ph√¢n bi·ªát Ch·ªõp m·∫Øt vs. Bu·ªìn ng·ªß: Ch·ªõp m·∫Øt di·ªÖn ra r·∫•t nhanh (< 0.2 gi√¢y). Bu·ªìn ng·ªß (Microsleep) th∆∞·ªùng k√©o d√†i > 0.5 - 1 gi√¢y.

Gi·∫£i ph√°p: Thay v√¨ ch·ªâ ƒë·∫øm frame li√™n ti·∫øp, h√£y √°p d·ª•ng ti√™u chu·∫©n PERCLOS (Percentage of Eyelid Closure) - Ti√™u chu·∫©n v√†ng trong c√¥ng nghi·ªáp √¥ t√¥.

Logic: T√≠nh % th·ªùi gian m·∫Øt nh·∫Øm trong m·ªôt c·ª≠a s·ªï th·ªùi gian (v√≠ d·ª•: trong 60 gi√¢y qua, m·∫Øt nh·∫Øm bao nhi√™u %). N·∫øu > 20% -> C·∫£nh b√°o.

X·ª≠ l√Ω khi c∆∞·ªùi: Khi c∆∞·ªùi, mi·ªáng (MAR) s·∫Ω tƒÉng theo chi·ªÅu ngang, m·∫Øt (EAR) gi·∫£m. N·∫øu EAR th·∫•p V√Ä MAR ngang tƒÉng -> ƒêang c∆∞·ªùi, kh√¥ng b√°o ƒë·ªông.

üëÑ Ph·∫ßn Mi·ªáng (MAR - Mouth Aspect Ratio)
V·∫•n ƒë·ªÅ hi·ªán t·∫°i: Khi n√≥i chuy·ªán ho·∫∑c h√°t, mi·ªáng c≈©ng m·ªü to -> H·ªá th·ªëng t∆∞·ªüng nh·∫ßm l√† ng√°p.

C·∫£i ti·∫øn c·∫ßn thi·∫øt:

Ki·ªÉm tra t·ªëc ƒë·ªô m·ªü mi·ªáng:

N√≥i chuy·ªán: Mi·ªáng m·ªü/ƒë√≥ng r·∫•t nhanh li√™n t·ª•c.

Ng√°p: Mi·ªáng m·ªü t·ª´ t·ª´ -> Gi·ªØ nguy√™n ƒë·ªô r·ªông (ƒë·ªânh ƒëi·ªÉm) -> ƒê√≥ng t·ª´ t·ª´. M·ªôt c√∫ ng√°p th∆∞·ªùng k√©o d√†i 3-5 gi√¢y.

Gi·∫£i ph√°p: Ch·ªâ t√≠nh l√† ng√°p khi MAR > ng∆∞·ª°ng trong √≠t nh·∫•t 20-30 frames li√™n ti·∫øp (kho·∫£ng 1-1.5 gi√¢y gi·ªØ nguy√™n tr·∫°ng th√°i m·ªü to).

üë§ Ph·∫ßn ƒê·∫ßu (Head Pose)
V·∫•n ƒë·ªÅ hi·ªán t·∫°i: Khi t√†i x·∫ø nh√¨n g∆∞∆°ng chi·∫øu h·∫≠u (quay tr√°i/ph·∫£i) ho·∫∑c nh√¨n b·∫£ng ƒëi·ªÅu khi·ªÉn (c√∫i nh·∫π), h·ªá th·ªëng b√°o m·∫•t t·∫≠p trung.

C·∫£i ti·∫øn c·∫ßn thi·∫øt:

ƒê·ªô tr·ªÖ (Time Delay): Ch·ªâ c·∫£nh b√°o khi t∆∞ th·∫ø ƒë·∫ßu b·∫•t th∆∞·ªùng gi·ªØ nguy√™n qu√° 2-3 gi√¢y. Vi·ªác nh√¨n g∆∞∆°ng ch·ªâ m·∫•t kho·∫£ng 1 gi√¢y.

V√πng an to√†n (Safe Zone): C·∫ßn ƒë·ªãnh nghƒ©a l·∫°i ng∆∞·ª°ng. V√≠ d·ª•: Quay tr√°i nh√¨n g∆∞∆°ng (Yaw -20 ƒë·ªô) l√† b√¨nh th∆∞·ªùng, nh∆∞ng quay ra sau n√≥i chuy·ªán (Yaw -45 ƒë·ªô) l√† c·∫£nh b√°o.

2. T√≠ch h·ª£p ƒêa ph∆∞∆°ng th·ª©c (Sensor Fusion) - Quan tr·ªçng nh·∫•t
Thay v√¨ 3 √¥ng (M·∫Øt, Mi·ªáng, ƒê·∫ßu) ho·∫°t ƒë·ªông ri√™ng l·∫ª, h√£y t·∫°o ra m·ªôt bi·∫øn g·ªçi l√† "Drowsiness Score" (ƒêi·ªÉm bu·ªìn ng·ªß).

T·∫°i sao c·∫ßn l√†m v·∫≠y? V√¨ ƒë√¥i khi m·∫Øt b·∫°n ch∆∞a nh·∫Øm h·∫≥n (EAR v·∫´n > 0.25), nh∆∞ng b·∫°n v·ª´a ng√°p 2 c√°i v√† ƒë·∫ßu h∆°i g·∫≠t g√π -> ƒê√≥ l√† d·∫•u hi·ªáu c·ª±c nguy hi·ªÉm s·∫Øp ng·ªß g·∫≠t.

Quy tr√¨nh ƒë·ªÅ xu·∫•t:

T·∫°o bi·∫øn score = 0.

M·ªói frame:

N·∫øu M·∫Øt nh·∫Øm: score += 1

N·∫øu Ng√°p: score += 3 (Ng√°p l√† d·∫•u hi·ªáu m·ªát m·ªèi r√µ r√†ng)

N·∫øu G·∫≠t ƒë·∫ßu: score += 2

N·∫øu B√¨nh th∆∞·ªùng: score -= 1 (Gi·∫£m d·∫ßn ƒëi·ªÉm khi t·ªânh t√°o, nh∆∞ng kh√¥ng nh·ªè h∆°n 0).

Ng∆∞·ª°ng c·∫£nh b√°o:

N·∫øu score > 15: C·∫£nh b√°o nh·∫π (Beep).

N·∫øu score > 30: C·∫£nh b√°o m·∫°nh (Alarm).

L·ª£i √≠ch: C∆° ch·∫ø n√†y gi√∫p h·ªá th·ªëng "nh·ªõ" tr·∫°ng th√°i m·ªát m·ªèi. N·∫øu b·∫°n v·ª´a ng√°p xong, ƒëi·ªÉm s·ªë ƒëang cao, ch·ªâ c·∫ßn m·∫Øt lim dim nh·∫π l√† h·ªá th·ªëng c·∫£nh b√°o ngay l·∫≠p t·ª©c, an to√†n h∆°n nhi·ªÅu so v·ªõi vi·ªác ch·ªù m·∫Øt nh·∫Øm h·∫≥n.

3. C√°c t√≠nh nƒÉng "S√°t th·ªß" n√™n b·ªï sung th√™m
ƒê·ªÉ d·ª± √°n n·ªïi b·∫≠t h·∫≥n so v·ªõi c√°c ƒë·ªì √°n sinh vi√™n kh√°c, b·∫°n h√£y th√™m:

A. Ch·∫ø ƒë·ªô Ban ƒë√™m / √Ånh s√°ng y·∫øu (Night Mode Enhancement)
Th·ª±c t·∫ø: T√†i x·∫ø hay bu·ªìn ng·ªß nh·∫•t v√†o ban ƒë√™m, nh∆∞ng Camera th∆∞·ªùng l·∫°i k√©m khi thi·∫øu s√°ng.

C·∫£i ti·∫øn:

S·ª≠ d·ª•ng thu·∫≠t to√°n Gamma Correction ho·∫∑c Histogram Equalization c·ªßa OpenCV ƒë·ªÉ l√†m s√°ng ·∫£nh ƒë·∫ßu v√†o tr∆∞·ªõc khi ƒë∆∞a v√†o MediaPipe.

Code snippet g·ª£i √Ω:

Python

# TƒÉng s√°ng ·∫£nh trong ƒëi·ªÅu ki·ªán t·ªëi
def enhance_image(frame):
    # Chuy·ªÉn sang YUV
    img_yuv = cv2.cvtColor(frame, cv2.COLOR_BGR2YUV)
    # C√¢n b·∫±ng s√°ng k√™nh Y
    img_yuv[:,:,0] = cv2.equalizeHist(img_yuv[:,:,0])
    # Chuy·ªÉn l·∫°i BGR
    return cv2.cvtColor(img_yuv, cv2.COLOR_YUV2BGR)
B. Ph√°t hi·ªán K√≠nh r√¢m (Sunglasses Detection)
Th·ª±c t·∫ø: T√†i x·∫ø th∆∞·ªùng ƒëeo k√≠nh r√¢m. MediaPipe c√≥ th·ªÉ b·∫Øt sai ƒëi·ªÉm m·∫Øt.

C·∫£i ti·∫øn:

N·∫øu h·ªá th·ªëng ph√°t hi·ªán EAR li√™n t·ª•c = 0 ho·∫∑c nh·∫£y lo·∫°n x·∫° trong th·ªùi gian d√†i -> Suy lu·∫≠n l√† c√≥ v·∫≠t c·∫£n (k√≠nh r√¢m).

Khi ƒë√≥: T·ª± ƒë·ªông chuy·ªÉn tr·ªçng s·ªë sang theo d√µi ƒê·∫ßu v√† Mi·ªáng, b·ªè qua M·∫Øt ho·∫∑c gi·∫£m ƒë·ªô tin c·∫≠y c·ªßa M·∫Øt xu·ªëng. Th√¥ng b√°o l√™n m√†n h√¨nh: "Ph√°t hi·ªán k√≠nh r√¢m - Chuy·ªÉn ch·∫ø ƒë·ªô gi√°m s√°t h√†nh vi".

C. L·ªùi khuy√™n th√¥ng minh (Smart Recommendations)
Thay v√¨ ch·ªâ h√∫ c√≤i B√≠p B√≠p, h√£y ph√°t ra gi·ªçng n√≥i (Text-to-Speech):

"B·∫°n ƒë√£ ng√°p 3 l·∫ßn trong 5 ph√∫t, h√£y d·ª´ng xe ngh·ªâ ng∆°i!"

"Ph√°t hi·ªán d·∫•u hi·ªáu m·ªát m·ªèi, tr·∫°m d·ª´ng ch√¢n ti·∫øp theo c√°ch 5km." (T√≠nh nƒÉng gi·∫£ l·∫≠p cao c·∫•p).